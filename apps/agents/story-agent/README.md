# StoryAgent Service

**Managed by Kiro** | AI Story Generation Micro-service

## Overview

StoryAgent is a micro-service that generates spooky, haunting stories using OpenAI GPT-4. It's part of the HauntedAI platform's multi-agent architecture.

## Features

- ğŸƒ Spooky story generation using GPT-4
- ğŸ”¥ RESTful API with Express
- âœ… Health check endpoint
- ğŸ›¡ï¸ Input validation and error handling
- ğŸ“Š Request logging
- ğŸ§ª Comprehensive test coverage

## API Endpoints

### Health Check
```
GET /health
```

Response:
```json
{
  "status": "ok",
  "service": "story-agent",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "openai": {
    "connected": true
  }
}
```

### Generate Story
```
POST /generate
Content-Type: application/json

{
  "input": "A ghost in an abandoned mansion",
  "userId": "optional-user-id",
  "roomId": "optional-room-id"
}
```

Response:
```json
{
  "story": "In the depths of the forgotten manor...",
  "metadata": {
    "wordCount": 342,
    "generatedAt": "2024-01-01T00:00:00.000Z",
    "model": "gpt-4"
  }
}
```

## Setup

### Prerequisites

- Node.js 20+
- OpenAI API key

### Installation

```bash
cd apps/agents/story-agent
npm install
```

### Configuration

Create a `.env` file:

```env
OPENAI_API_KEY=your_openai_api_key_here
PORT=3002
NODE_ENV=development
```

### Running

```bash
# Development mode
npm run dev

# Production mode
npm run build
npm start
```

## Testing

```bash
# Run all tests
npm test

# Run with coverage
npm run test:coverage

# Watch mode
npm run test:watch
```

## Architecture

```
StoryAgent
â”œâ”€â”€ server.ts          # Express server setup
â”œâ”€â”€ story.service.ts   # OpenAI integration
â”œâ”€â”€ types.ts           # TypeScript interfaces
â””â”€â”€ index.ts           # Entry point
```

## Error Handling

The service handles various error scenarios:

- Empty or whitespace-only input
- OpenAI API failures
- Network timeouts
- Invalid requests

All errors return a consistent error response format:

```json
{
  "error": "Error Type",
  "message": "Detailed error message",
  "statusCode": 400,
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## Integration

This service is designed to be called by the Orchestrator service as part of the HauntedAI workflow:

1. User submits input
2. Orchestrator calls StoryAgent
3. StoryAgent generates story
4. Story is uploaded to Storacha
5. Workflow continues to AssetAgent

## Monitoring

The service logs all requests and errors to stdout. In production, these logs should be collected by a centralized logging system.

## License

MIT

---

**Generated by Kiro** | HauntedAI Platform
